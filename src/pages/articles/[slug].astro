---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import Navigation from '../../components/Navigation.astro';
import Footer from '../../components/Footer.astro';

export async function getStaticPaths() {
  const blogPosts = await getCollection('blog');
  return blogPosts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

// SEO settings
const pageTitle = post.data.seo?.metaTitle || `${post.data.title} | Floorplay Agency`;
const pageDescription = post.data.seo?.metaDescription || post.data.description;
const canonicalUrl = `https://floorplay.agency/articles/${post.slug}/`;

// Format date helper
function formatDate(date: Date): string {
  const formatted = date.toLocaleDateString('en-US', { 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric' 
  });
  // Convert "August" to "AUG" in all caps
  return formatted.replace('August', 'AUG');
}

// Article schema for SEO
const articleSchema = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": post.data.title,
  "description": post.data.description,
  "image": `https://floorplay.agency/og-${post.slug}.jpg`,
  "author": {
    "@type": "Person",
    "name": post.data.author
  },
  "publisher": {
    "@type": "Organization",
    "name": "Floorplay Agency",
    "logo": {
      "@type": "ImageObject",
      "url": "https://floorplay.agency/icon-512.png"
    }
  },
  "datePublished": post.data.publishDate.toISOString(),
  "dateModified": post.data.publishDate.toISOString(),
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": canonicalUrl
  }
};
---

<Layout 
  title={pageTitle}
  description={pageDescription}
  canonical={canonicalUrl}
  keywords={post.data.seo?.keywords}
>
  <!-- Article Schema -->
  <script type="application/ld+json" slot="head" set:html={JSON.stringify(articleSchema)}></script>

  <!-- Header Section -->
  <section class="header-section">
    <div class="container">
      <Navigation currentPage="blog" />
    </div>
  </section>

  <!-- Article Hero -->
  <section class="article-hero">
    <div class="container">
      <div class="breadcrumbs">
        <a href="/articles/">All Articles</a>
        <span class="breadcrumb-separator">→</span>
        <span>Article</span>
      </div>
      
      <div class="article-header">
        <h1 class="article-title">{post.data.title}</h1>
        <p class="article-description">{post.data.description}</p>
      </div>
    </div>
  </section>

  <!-- Article Image -->
  <section class="article-image-section">
    <div class="container">
      <div class="article-image-container">
        {post.data.heroImage ? (
          <img src={post.data.heroImage} alt={post.data.title} class="article-image" />
        ) : (
          <div class="article-image-placeholder"></div>
        )}
      </div>
    </div>
  </section>

  <!-- Newsletter CTA - Below Image -->
  <section class="hero-newsletter-section">
    <div class="container">
      <div class="newsletter-hero-cta">
        <div class="cta-content">
          <h2 class="cta-title">JUST WANT THE WEEKLY TIPS EVERY MONDAY?</h2>
          <form class="cta-form" action="https://app.kit.com/forms/8456136/subscriptions" method="post">
            <div class="form-row">
              <input 
                type="email" 
                name="email_address"
                placeholder="YOUR BEST EMAIL"
                class="email-input"
                required
              />
              <input type="hidden" name="subscribe" value="1" />
              <input type="hidden" name="redirect" value="https://floorplay.agency/newsletter-thank-you/" />
              <button type="submit" class="cta-button">
                <span>SIGN ME UP</span>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="arrow-icon">
                  <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>

  <!-- Article Content -->
  <section class="article-content-section">
    <div class="container">
      <div class="article-content">
        <Content />
        
        <!-- TOC injection via JavaScript -->
        {post.data.tableOfContents && (
          <script define:vars={{ tocData: post.data.tableOfContents }}>
            // Find and replace the TABLE_OF_CONTENTS comment
            const walker = document.createTreeWalker(
              document.querySelector('.article-content'),
              NodeFilter.SHOW_COMMENT,
              null,
              false
            );
            
            let commentNode;
            while (commentNode = walker.nextNode()) {
              if (commentNode.textContent.trim() === 'TABLE_OF_CONTENTS') {
                // Create TOC HTML
                const tocContainer = document.createElement('div');
                tocContainer.className = 'toc-container';
                tocContainer.style.cssText = 'background: #f9f6f0 !important; border: 2px solid #000000 !important; border-radius: 0 !important; padding: 32px !important; width: 100%; margin: 40px 0; box-sizing: border-box;';
                
                tocContainer.innerHTML = `
                  <h3 class="toc-title" style="font-family: 'Big Shoulders Display', sans-serif; font-weight: 700; font-size: 40px; color: #1a1309; margin: 0 0 8px 0; line-height: 1.3; letter-spacing: -0.8px;">Table of Contents</h3>
                  <ol class="toc-list toc-no-counter" style="margin: 0; padding: 0; display: flex; flex-direction: column; gap: 8px; list-style: none; counter-reset: none;">
                    ${tocData.map((item, index) => 
                      `<li style="margin: 0; display: flex; align-items: flex-start; gap: 8px; padding-left: 0; position: static;">
                        <span style="width: 32px; height: 32px; background-color: #0040ff; border-radius: 0; color: #ffffff; font-family: 'Work Sans', sans-serif; font-weight: 400; font-size: 20px; display: flex; align-items: center; justify-content: center; line-height: 1.5; letter-spacing: -0.4px; flex-shrink: 0;">${index + 1}</span>
                        <a href="#${item.anchor}" class="toc-link" style="font-family: 'Work Sans', sans-serif; font-weight: 400; font-size: 20px; color: #0040ff !important; text-decoration: none !important; line-height: 1.5; letter-spacing: -0.4px; flex: 1; display: flex; align-items: center;">${item.title} →</a>
                      </li>`
                    ).join('')}
                  </ol>
                `;
                
                // Replace comment with TOC
                commentNode.parentNode.insertBefore(tocContainer, commentNode);
                commentNode.remove();
                
                // Add smooth scroll behavior to TOC links and add underline on hover
                const tocLinks = tocContainer.querySelectorAll('.toc-link');
                tocLinks.forEach(link => {
                  // Add underline on hover
                  link.addEventListener('mouseenter', function() {
                    this.style.textDecoration = 'underline !important';
                  });
                  
                  link.addEventListener('mouseleave', function() {
                    this.style.textDecoration = 'none !important';
                  });
                  
                  link.addEventListener('click', function(e) {
                    const targetId = this.getAttribute('href').substring(1);
                    const targetElement = document.getElementById(targetId);
                    
                    if (targetElement) {
                      e.preventDefault();
                      targetElement.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                      });
                    }
                    // If target not found, let browser handle default behavior
                  });
                });
                
                break;
              }
            }
          </script>
        )}
      </div>
    </div>
  </section>



  <Footer />
</Layout>

<style>
  /* Container */
  .container {
    max-width: 800px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  /* Header Section */
  .header-section {
    background: #ffffff;
    padding: 72px 0;
  }

  /* Article Hero */
  .article-hero {
    background: #ffffff;
    padding: 20px 0 20px;
  }

  .breadcrumbs {
    font-family: 'Work Sans', sans-serif;
    font-size: 14px;
    color: #6b7280;
    margin-bottom: 32px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .breadcrumbs a {
    color: #0040ff;
    text-decoration: none;
  }

  .breadcrumbs a:hover {
    text-decoration: underline;
  }

  .breadcrumb-separator {
    color: #d1d5db;
  }

  .article-header {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .article-title {
    font-family: 'Big Shoulders Display', sans-serif;
    font-weight: 700;
    font-size: 56px;
    color: #1a1309;
    line-height: 1.1;
    margin: 0;
    text-wrap: balance;
  }

  .article-description {
    font-family: 'Work Sans', sans-serif;
    font-weight: 400;
    font-size: 20px;
    color: #4b5563;
    line-height: 1.4;
    margin: 0;
    text-wrap: pretty;
  }

  /* Article Image Section */
  .article-image-section {
    background: #ffffff;
    padding: 0;
  }

  .article-image-container {
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
  }

  .article-image {
    width: 100%;
    height: 400px;
    object-fit: cover;
    border-radius: 0;
  }

  .article-image-placeholder {
    width: 100%;
    height: 400px;
    background: #e5e3de;
    border-radius: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Table of Contents - Figma Design */
  .toc-container {
    background: #f9f6f0 !important;
    border: 2px solid #000000 !important;
    border-radius: 0 !important;
    padding: 32px !important;
    max-width: 600px;
    margin: 40px auto;
    box-sizing: border-box;
  }

  .toc-title {
    font-family: 'Big Shoulders Display', sans-serif;
    font-weight: 700;
    font-size: 40px;
    color: #1a1309;
    margin: 0 0 8px 0;
    text-transform: none;
    line-height: 1.3;
    letter-spacing: -0.8px;
  }

  .toc-list {
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .toc-list li {
    margin: 0;
    display: flex;
    align-items: flex-start;
    gap: 8px;
  }

  .toc-list li::before {
    content: counter(custom-counter);
    width: 32px;
    height: 32px;
    background-color: #0040ff;
    border-radius: 0;
    color: #ffffff;
    font-family: 'Work Sans', sans-serif;
    font-weight: 400;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1.5;
    letter-spacing: -0.4px;
    flex-shrink: 0;
  }

  .toc-link {
    font-family: 'Work Sans', sans-serif;
    font-weight: 400;
    font-size: 20px;
    color: #0040ff !important;
    text-decoration: none;
    line-height: 1.5;
    letter-spacing: -0.4px;
    transition: opacity 0.3s ease;
    flex: 1;
    display: flex;
    align-items: center;
  }

  .toc-link::after {
    content: " →";
    margin-left: 4px;
  }

  .toc-link:hover {
    opacity: 0.8;
    color: #0040ff !important;
  }

  .toc-link:visited {
    color: #0040ff !important;
  }

  .toc-link:active {
    color: #0040ff !important;
  }

  /* Override global article content link styles with maximum specificity */
  .article-content .toc-container .toc-list .toc-link,
  .article-content .toc-container .toc-link,
  .toc-container .toc-list .toc-link,
  .toc-container .toc-link {
    color: #0040ff !important;
    text-decoration: none !important;
  }

  .article-content .toc-container .toc-list .toc-link:hover,
  .article-content .toc-container .toc-list .toc-link:visited,
  .article-content .toc-container .toc-list .toc-link:active,
  .article-content .toc-container .toc-link:hover,
  .article-content .toc-container .toc-link:visited,
  .article-content .toc-container .toc-link:active,
  .toc-container .toc-list .toc-link:hover,
  .toc-container .toc-list .toc-link:visited,
  .toc-container .toc-list .toc-link:active,
  .toc-container .toc-link:hover,
  .toc-container .toc-link:visited,
  .toc-container .toc-link:active {
    color: #0040ff !important;
    text-decoration: none !important;
  }

  /* Disable global ordered list styles for TOC */
  .toc-container ol {
    counter-reset: none !important;
  }

  .toc-container ol li {
    counter-increment: none !important;
    padding-left: 0 !important;
    position: static !important;
  }

  .toc-container ol li::before {
    display: none !important;
  }

  /* Newsletter CTA - Hero Style */
  .hero-newsletter-section {
    background: #ffffff;
    padding: 24px 0;
  }

  .newsletter-hero-cta {
    background: #0040ff;
    width: 860px;
    max-width: 100%;
    margin: 0 auto;
    padding: 16px 32px 32px 32px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .newsletter-hero-cta .cta-content {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .newsletter-hero-cta .cta-title {
    font-family: 'Work Sans', sans-serif !important;
    font-weight: 700 !important;
    font-size: 22px !important;
    color: #ffffff !important;
    text-transform: uppercase;
    line-height: 1.1;
    margin: 0;
  }

  .newsletter-hero-cta .cta-form {
    width: 100%;
  }

  .newsletter-hero-cta .form-row {
    display: flex;
    gap: 8px;
    height: 56px;
    align-items: stretch;
  }

  .newsletter-hero-cta .email-input {
    flex: 1;
    background: #ffffff;
    border: none;
    padding: 16px 8px;
    font-family: 'Work Sans', sans-serif;
    font-weight: 500;
    font-size: 18px;
    color: #000000;
    text-transform: uppercase;
    outline: none;
  }

  .newsletter-hero-cta .email-input::placeholder {
    color: #616161;
    font-weight: 500;
    text-transform: uppercase;
  }

  .newsletter-hero-cta .cta-button {
    background: transparent;
    border: 4px solid #ffffff;
    color: #ffffff;
    padding: 16px;
    font-family: 'Work Sans', sans-serif;
    font-weight: 700;
    font-size: 18px;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    white-space: nowrap;
    line-height: 1.1;
  }

  .newsletter-hero-cta .cta-button:hover {
    background: #ffffff;
    color: #0040ff;
    transform: translateY(-1px);
  }

  .newsletter-hero-cta .arrow-icon {
    width: 24px;
    height: 24px;
    flex-shrink: 0;
    transition: transform 0.3s ease;
  }

  .newsletter-hero-cta .cta-button:hover .arrow-icon {
    transform: translateX(2px);
  }

  /* Article Content */
  .article-content-section {
    background: #ffffff;
    padding: 8px 0 80px;
  }

  .article-content {
    font-family: 'Work Sans', sans-serif;
    font-weight: 400;
    font-size: 20px;
    color: #1a1309;
    line-height: 1.7;
  }

  h2,
  .article-content h2,
  .article-content-section h2,
  .article-content-section .article-content h2,
  section h2,
  article h2 {
    font-family: 'Big Shoulders Display', sans-serif !important;
    font-weight: 900 !important;
    font-size: 40px !important;
    color: #1a1309 !important;
    margin: 16px 0 8px 0 !important;
    line-height: 1.3 !important;
    letter-spacing: -0.8px !important;
  }

  .article-content h3 {
    font-family: 'Big Shoulders Display', sans-serif !important;
    font-weight: 700 !important;
    font-size: 28px !important;
    color: #1a1309;
    margin: 40px 0 20px 0;
    line-height: 1.3;
  }

  .article-content h4 {
    font-family: 'Work Sans', sans-serif;
    font-weight: 700;
    font-size: 20px;
    color: #1a1309;
    margin: 32px 0 16px 0;
  }

  .article-content p {
    margin: 0 0 24px 0;
  }

  .article-content ul,
  .article-content ol {
    margin: 24px 0;
    padding-left: 24px;
  }

  .article-content li {
    margin-bottom: 12px;
  }

  .article-content strong {
    font-weight: 700;
    color: #1a1309;
  }

  .article-content blockquote {
    border-left: 4px solid #0040ff;
    padding: 16px 24px;
    margin: 32px 0;
    background: #f9f6f0;
    font-style: italic;
    color: #4b5563;
  }



  /* Mobile Responsive */
  @media (max-width: 768px) {
    .header-section {
      padding: 40px 0;
    }

    .article-hero {
      padding: 15px 0 40px;
    }

    .article-title {
      font-size: 40px;
    }

    .article-description {
      font-size: 18px;
    }

    .article-image-section {
      padding: 0;
    }

    .article-image-placeholder {
      height: 250px;
    }

    .toc-container {
      padding: 24px;
      max-width: 100%;
      margin: 32px 0;
    }

    .toc-title {
      font-size: 28px;
      margin-bottom: 16px;
    }

    .toc-list li::before {
      width: 28px;
      height: 28px;
      font-size: 16px;
    }

    .toc-link {
      font-size: 16px;
    }

    .hero-newsletter-section {
      padding: 24px 0;
    }

    .newsletter-hero-cta {
      width: 100%;
      padding: 24px;
    }

    .newsletter-hero-cta .cta-title {
      font-size: 18px !important;
      font-family: 'Work Sans', sans-serif !important;
      font-weight: 500 !important;
      color: #ffffff !important;
    }

    .newsletter-hero-cta .form-row {
      flex-direction: column;
      height: auto;
      gap: 12px;
    }

    .newsletter-hero-cta .email-input {
      height: 48px;
      font-size: 16px;
    }

    .newsletter-hero-cta .cta-button {
      height: 48px;
      font-size: 16px;
      justify-content: center;
    }

    .article-content {
      font-size: 18px;
    }

    .article-content h2 {
      font-size: 32px !important;
      font-weight: 900 !important;
      margin: 32px 0 16px 0;
      letter-spacing: -0.64px;
    }

    .article-content h3 {
      font-size: 24px !important;
      margin: 28px 0 16px 0;
    }

  }
</style>